<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Esparagoza Dental Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<style>
:root{
  --brand:#0b6bcb;
  --accent:#2ea0ff;
  --success:#00b386;
  --danger:#d9534f;
  --card-bg:#ffffff;
  --muted:#999;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif;scroll-behavior:smooth}
html,body{height:100%}
body{
  background:linear-gradient(180deg,#e9f4ff 0%,#f4f9ff 100%);
  min-height:100vh;overflow-x:hidden;color:var(--brand);
}
.app{position:relative;min-height:100vh;display:flex;align-items:stretch;justify-content:center}

/* FRONT PAGE */
#frontPage{
  position:fixed;inset:0;
  background-image:url('https://i.imgur.com/EHVhWYb.jpeg');
  background-size:cover;background-position:center;
  display:flex;align-items:center;justify-content:center;
  z-index:40;opacity:1;transform:scale(1);
  transition:opacity .7s ease,transform .7s ease;
}
#frontPage.fadeOut{opacity:0;pointer-events:none;transform:scale(1.03)}
.front-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(255,255,255,.08));backdrop-filter:blur(1px)}
.front-inner{
  position:relative;z-index:2;max-width:920px;width:92%;text-align:center;
  padding:36px;border-radius:14px;color:#fff;
  display:flex;flex-direction:column;align-items:center;gap:12px;
}
.logo-big{width:140px;height:auto;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
.welcome{font-size:28px;font-weight:700;color:#fff;text-shadow:0 3px 14px rgba(0,0,0,.4)}
.muted-white{color:rgba(255,255,255,.9);font-weight:600}
.meta-row{display:flex;gap:14px;align-items:center;flex-wrap:wrap;justify-content:center}
.pill{background:rgba(255,255,255,.12);padding:10px 14px;border-radius:999px;font-weight:700;color:#fff}
.status-in{background:linear-gradient(90deg,#67e3a1,#00b386);color:#053017}
.status-out{background:linear-gradient(90deg,#ffdede,#ff8a8a);color:#4a0b0b}
.cta-btn{margin-top:12px;padding:14px 22px;border-radius:12px;border:none;font-weight:700;
  background:linear-gradient(90deg,var(--accent),var(--brand));color:#fff;cursor:pointer;
  box-shadow:0 8px 26px rgba(11,107,203,.24);transition:transform .16s ease}
.cta-btn:active{transform:translateY(1px) scale(.997)}

/* FRONT PAGE TOP NAV */
.front-top{position:absolute;top:16px;right:16px;z-index:60;display:flex;align-items:center;gap:10px}
.nav-links{display:flex;gap:10px;align-items:center;background:rgba(255,255,255,.06);padding:8px;border-radius:10px}
.menu-btn{background:linear-gradient(90deg,var(--accent),var(--brand));color:#fff;border:none;padding:8px 10px;border-radius:10px;font-size:18px;cursor:pointer}
@media(max-width:900px){.nav-links{display:none}.menu-btn{display:inline-flex}}
@media(min-width:901px){.menu-btn{display:none}.nav-links{display:flex}}

/* === Frosted dropdown (desktop) === */
.nav-item{position:relative;padding:6px 12px;cursor:pointer;color:#fff;font-weight:700}
.nav-item:hover{background:rgba(255,255,255,.08)}
.dropdown{
  display:none;position:absolute;top:110%;left:50%;
  transform:translateX(-50%) translateY(-6px);
  background:rgba(255,255,255,.82);
  backdrop-filter:blur(10px);
  color:var(--brand);
  border-radius:0;               /* sharp corners */
  padding:14px 18px;
  min-width:240px;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
  text-align:left;
  opacity:0;pointer-events:none;
}
.nav-item:last-child .dropdown{
  right:0;left:auto;transform:translateY(-6px);
}
.nav-item:hover .dropdown{
  display:block;
  animation:dropdownSlide .3s ease forwards;
  pointer-events:all;
}
@keyframes dropdownSlide{
  from{opacity:0;transform:translateX(-50%) translateY(-10px);}
  to{opacity:1;transform:translateX(-50%) translateY(0);}
}
.dropdown h4{font-size:15px;font-weight:700;margin-bottom:6px;border-bottom:1px solid #d0e2f5;padding-bottom:3px}
.dropdown p,.dropdown li{font-size:13px;line-height:1.5;margin:3px 0}
@media(max-width:900px){.nav-item .dropdown{display:none!important}}

/* BOOKING PAGE + components */
#bookingPage{opacity:0;transform:translateY(12px);transition:opacity .7s ease,transform .7s ease;max-width:980px;width:100%;padding:28px 20px;margin:36px auto 80px}
#bookingPage.show{opacity:1;transform:translateY(0)}
.book-logo{display:block;margin:0 auto 10px auto;width:100px}
.card{background:var(--card-bg);border-radius:16px;box-shadow:0 10px 30px rgba(7,36,63,.08);padding:22px;margin:18px auto;max-width:520px}
label{display:block;margin:8px 0 4px;color:var(--brand);font-weight:600}
input,select,textarea{width:100%;padding:10px 12px;border:1px solid #d5e6f7;border-radius:10px;font-size:15px;outline:none}
.btn-primary{cursor:pointer;transition:.3s;background:linear-gradient(90deg,var(--accent),var(--brand));color:#fff;border:none;border-radius:10px;padding:12px 18px;font-weight:700;width:100%}
.weeknames{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;color:#3b6b90;font-size:12px;text-align:center;margin-bottom:6px}
.cal-grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:8px;width:100%}
.day-tile{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;border-radius:10px;background:#fff;color:var(--brand);font-weight:600;cursor:pointer;transition:background .2s,transform .2s}
.day-tile:hover{transform:scale(1.06)}
.day-tile.today{border:2px solid var(--brand)}
.day-tile.closed{background:#e0e0e0;color:#888;cursor:not-allowed}
.slot-btn{padding:10px;border:none;border-radius:8px;margin:4px;background:#e7f1ff;color:var(--brand);font-weight:600;transition:all .2s}
.slot-btn.selected{background:var(--brand);color:#fff}
.slot-btn.booked{background:#ccc;color:#666;cursor:not-allowed}
.toast-wrap{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:1000}
.toast{background:var(--brand);color:#fff;padding:10px 16px;border-radius:8px;margin-top:8px;opacity:0;transition:opacity .3s}
.toast.show{opacity:1}
.toast.success{background:var(--success)}
.toast.error{background:var(--danger)}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);backdrop-filter:blur(4px);justify-content:center;align-items:center;z-index:1001;opacity:0;transition:opacity .5s ease}
.modal-overlay.show{display:flex;opacity:1}
.modal-content{background:#fff;border-radius:16px;max-width:420px;width:90%;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.15);color:var(--brand);max-height:80vh;overflow-y:auto;animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:scale(.97)}to{opacity:1;transform:scale(1)}}
.close-btn{position:absolute;top:12px;right:16px;background:var(--brand);color:#fff;border:none;border-radius:50%;width:32px;height:32px;font-size:18px;font-weight:bold;cursor:pointer}
.fade-section{animation:fadeIn .5s ease}
</style>
</head>

  <body>
<div class="app">

  <!-- FRONT PAGE -->
  <section id="frontPage">
    <div class="front-overlay"></div>
    <div class="front-top">
      <!-- Desktop Dropdown Navigation -->
      <nav class="nav-links" id="desktopNav">
        <div class="nav-item">
          <span>About Us</span>
          <div class="dropdown">
            <p><b>Orthodontics, Implant & General Dentistry</b></p>
            <p>Dr. Jeff Esparagoza provides quality dental care in Kidapawan City.</p>
          </div>
        </div>
        <div class="nav-item">
          <span>Services</span>
          <div class="dropdown">
            <ul style="list-style:none;padding:0;margin:0;">
              <li>Pediatric Dentistry</li>
              <li>Restorative Dentistry</li>
              <li>Prosthodontics</li>
              <li>Veneers & Dental Crown</li>
              <li>Cosmetic Dentistry</li>
              <li>Oral Surgery</li>
              <li>Orthodontics</li>
            </ul>
          </div>
        </div>
        <div class="nav-item">
          <span>Protocols</span>
          <div class="dropdown">
            <h4>General Instructions</h4>
            <ul style="margin:0;padding:0;list-style:none;">
              <li>NO MASK, NO ENTRY</li>
              <li>OBSERVE SOCIAL DISTANCING</li>
              <li>ALCOHOL IS AVAILABLE FOR PATIENT'S USE</li>
              <li>Only PATIENTS are allowed inside treatment room</li>
              <li>We discourage bringing companions except for minors or elders</li>
            </ul>
            <h4 style="margin-top:10px;">Schedules / Appointments</h4>
            <p style="margin-top:3px;">New Clinic Hours: <b>Mon‚ÄìSat, 9:00 AM ‚Äì 4:00 PM</b></p>
            <p>Clinic Schedule is now <b>STRICTLY BY APPOINTMENT</b>.</p>
          </div>
        </div>
        <div class="nav-item">
          <span>Contact</span>
          <div class="dropdown">
            <p>üìç Kidapawan City, North Cotabato</p>
            <p>üìû 0977 780 9537</p>
            <p>üìß esparagoza.jeffrey@gmail.com</p>
          </div>
        </div>
      </nav>
      <button class="menu-btn" id="menuBtn">&#9776;</button>
    </div>

    <div class="front-inner">
      <img src="https://i.imgur.com/t942gBV.png" class="logo-big" alt="logo">
      <div class="welcome">Welcome to Esparagoza Dental Clinic</div>
      <div class="meta-row">
        <div class="pill muted-white" id="todayDate">Today</div>
        <div class="pill muted-white" id="dentistStatus">Dentist: ...</div>
      </div>
      <button class="cta-btn" id="toBookingBtn">Make an Appointment</button>
    </div>
  </section>

  <!-- BOOKING PAGE -->
  <main id="bookingPage" aria-hidden="true">
    <img src="https://i.imgur.com/t942gBV.png" alt="logo" class="book-logo">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <button class="btn-primary" id="prevMonth" style="width:48px">&#10094;</button>
        <div style="font-weight:700;color:var(--brand);font-size:18px" id="monthTitle">Month</div>
        <button class="btn-primary" id="nextMonth" style="width:48px">&#10095;</button>
      </div>
      <div class="weeknames">
        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div>
        <div>Thu</div><div>Fri</div><div>Sat</div>
      </div>
      <div class="cal-grid" id="calGrid"></div>
      <p style="text-align:center;font-size:12px;margin-top:6px;color:#3b6b90">
        Closed or fully booked dates are grayed out.
      </p>
    </div>

    <section class="card" id="bookingFormSection">
      <h2 style="color:var(--brand);margin-bottom:10px">Book an Appointment</h2>
      <form id="bookingForm">
        <label>Full Name</label><input type="text" id="name" required>
        <label>Email</label><input type="email" id="email" required>
        <label>Phone</label><input type="text" id="phone" required>
        <label>Service</label>
        <select id="service" required>
          <option value="">Select Service</option>
          <option>Pediatric Dentistry</option>
          <option>Restorative Dentistry (Tooth Filling)</option>
          <option>Prosthodontics</option>
          <option>Veneers Dental Crown</option>
          <option>Cosmetic Dentistry</option>
          <option>Oral Surgery</option>
          <option>Orthodontics</option>
        </select>
        <label>Date</label><input type="text" id="date" readonly required>
        <label>Time</label><input type="text" id="time" readonly required>
        <div id="slotsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:6px;margin:10px 0;"></div>
        <label>Notes (optional)</label><textarea id="notes" rows="2"></textarea>
        <button class="btn-primary" type="submit">Submit Booking</button>
      </form>
    </section>
  </main>

  <div class="toast-wrap" id="toastWrap"></div>

  <!-- MODAL -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <button class="close-btn" id="closeModal">&times;</button>
      <div id="sectionContent"></div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue, get, set, push, runTransaction }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig={
      apiKey:"AIzaSyCV39b2CkzS_tt75SVXa6z95s6f4qVlfLg",
      authDomain:"esparagozadentalclinic-6a744.firebaseapp.com",
      databaseURL:"https://esparagozadentalclinic-6a744-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId:"esparagozadentalclinic-6a744",
      storageBucket:"esparagozadentalclinic-6a744.firebasestorage.app",
      messagingSenderId:"959639046373",
      appId:"1:959639046373:web:ccf39df13d94e527fcec0c"
    };
    const app=initializeApp(firebaseConfig);
    const db=getDatabase(app);

    const el=id=>document.getElementById(id);
    const frontPage=el("frontPage"),toBookingBtn=el("toBookingBtn"),bookingPage=el("bookingPage"),
      calGrid=el("calGrid"),prevMonth=el("prevMonth"),nextMonth=el("nextMonth"),
      monthTitle=el("monthTitle"),dateInput=el("date"),timeInput=el("time"),
      slotsGrid=el("slotsGrid"),toastWrap=el("toastWrap"),todayDate=el("todayDate"),
      dentistStatusEl=el("dentistStatus"),modalOverlay=el("modalOverlay"),
      closeModal=el("closeModal"),sectionContent=el("sectionContent"),menuBtn=el("menuBtn");

    let displayedYear,displayedMonth,closedDates={},slotCounts={},maxSlots=1;

    const TIME_SLOTS=["9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM",
      "12:00 NN","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM"];
    const fmt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
    const slotKey=s=>s.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();

    function showToast(msg,type="info"){const el=document.createElement("div");
      el.className=`toast ${type}`;el.textContent=msg;toastWrap.appendChild(el);
      setTimeout(()=>el.classList.add("show"),100);setTimeout(()=>el.remove(),3000);}

    onValue(ref(db,"closed_dates"),s=>{closedDates=s.exists()?s.val():{};renderCalendar();});
    onValue(ref(db,"settings/maxSlots"),s=>{maxSlots=s.exists()?s.val():1;});
    onValue(ref(db,"slot_counts"),s=>{slotCounts=s.exists()?s.val():{};renderCalendar();});
    onValue(ref(db,"dentist_status"),s=>{
      const v=s.exists()?String(s.val()).toUpperCase():"OUT";
      dentistStatusEl.textContent=`Dentist: ${v}`;
      dentistStatusEl.classList.toggle("status-in",v==="IN");
      dentistStatusEl.classList.toggle("status-out",v!=="IN");
    });
    todayDate.textContent=new Date().toLocaleDateString(undefined,{weekday:"short",month:"short",day:"numeric",year:"numeric"});

    function sendEmail(tid,data){
      emailjs.init("cVyQCkIy0P6hPyKrH");
      return emailjs.send("service_7k6q958",tid,data)
        .then(()=>showToast("Confirmation email sent!","success"))
        .catch(()=>showToast("Email not sent.","error"));
    }

    function renderCalendar(y,m){
      const now=new Date();if(!y&&!m){y=now.getFullYear();m=now.getMonth();}
      displayedYear=y;displayedMonth=m;
      const first=new Date(y,m,1);monthTitle.textContent=first.toLocaleString("default",{month:"long",year:"numeric"});
      calGrid.innerHTML="";const start=first.getDay();const days=new Date(y,m+1,0).getDate();
      for(let i=0;i<start;i++){const e=document.createElement("div");e.className="day-tile";e.style.visibility="hidden";calGrid.appendChild(e);}
      for(let d=1;d<=days;d++){const date=new Date(y,m,d),iso=fmt(date);
        const div=document.createElement("div");div.className="day-tile";div.textContent=d;
        const counts=slotCounts[iso]||{},full=Object.values(counts).filter(v=>v>=maxSlots).length>=TIME_SLOTS.length;
        if(closedDates[iso]||full)div.classList.add("closed");
        else if(date<new Date().setHours(0,0,0,0))div.style.opacity=.4;
        else div.onclick=()=>{dateInput.value=iso;loadSlots(iso);showToast("Selected "+iso,"success");el("bookingFormSection").scrollIntoView({behavior:"smooth"});}
        const t=new Date();t.setHours(0,0,0,0);if(date.getTime()===t.getTime())div.classList.add("today");
        calGrid.appendChild(div);}
    }
    prevMonth.onclick=()=>{const d=new Date(displayedYear,displayedMonth-1,1);renderCalendar(d.getFullYear(),d.getMonth());};
    nextMonth.onclick=()=>{const d=new Date(displayedYear,displayedMonth+1,1);renderCalendar(d.getFullYear(),d.getMonth());};
    renderCalendar();

    async function loadSlots(dateKey){
      slotsGrid.innerHTML="";const cSnap=await get(ref(db,`slot_counts/${dateKey}`));
      const counts=cSnap.exists()?cSnap.val():{};
      TIME_SLOTS.forEach(slot=>{
        const k=slotKey(slot),c=counts[k]||0,full=c>=maxSlots;
        const b=document.createElement("button");b.className="slot-btn";
        b.textContent=slot+(full?" ‚Ä¢ FULL":"");
        if(full)b.classList.add("booked");
        else b.onclick=()=>{timeInput.value=slot;document.querySelectorAll(".slot-btn").forEach(x=>x.classList.remove("selected"));b.classList.add("selected");};
        slotsGrid.appendChild(b);
      });
    }

    const nameEl=el("name"),emailEl=el("email"),phoneEl=el("phone"),serviceEl=el("service"),notesEl=el("notes");
    el("bookingForm").onsubmit=async e=>{
      e.preventDefault();
      const name=nameEl.value.trim(),email=emailEl.value.trim(),phone=phoneEl.value.trim(),
            notes=notesEl.value.trim(),service=serviceEl.value,date=dateInput.value,time=timeInput.value;
      if(!date||!time)return showToast("Select date & time!","error");
      const key=slotKey(time),slotRef=ref(db,`slot_counts/${date}/${key}`);
      try{
        const booked=await runTransaction(slotRef,c=>(c||0)+1);
        if(booked.snapshot.val()>maxSlots){showToast("Time slot full!","error");return;}
        const newRef=push(ref(db,"bookings"));
        await set(newRef,{name,email,phone,service,date,time,notes,createdAt:new Date().toISOString()});
        sendEmail("template_td348he",{name,email,phone,service,date,time,notes});
        showToast("Booking successful!","success");
        e.target.reset();timeInput.value="";renderCalendar(displayedYear,displayedMonth);
      }catch(err){console.error(err);showToast("Booking failed!","error");}
    };

    toBookingBtn.onclick=()=>{frontPage.classList.add("fadeOut");setTimeout(()=>bookingPage.classList.add("show"),400);};

    /* === Modal Menu === */
    function openModal(html){sectionContent.innerHTML=html;sectionContent.classList.add("fade-section");
      modalOverlay.style.display="flex";setTimeout(()=>modalOverlay.classList.add("show"),10);}
    function closeModalNow(){modalOverlay.classList.remove("show");setTimeout(()=>modalOverlay.style.display="none",500);}
    closeModal.onclick=closeModalNow;modalOverlay.onclick=e=>{if(e.target===modalOverlay)closeModalNow();};

    function menuHTML(){return `<div class="fade-section" style="text-align:center;">
      <h3>Menu</h3>
      <button class="btn-primary" style="margin:6px 0;" data-sec="about">About Us</button><br>
      <button class="btn-primary" style="margin:6px 0;" data-sec="services">Services</button><br>
      <button class="btn-primary" style="margin:6px 0;" data-sec="protocols">Protocols</button><br>
      <button class="btn-primary" style="margin:6px 0;" data-sec="contact">Contact</button></div>`;}

    const sections={
      about:`<div class="fade-section"><h3>About Us</h3><p><b>Orthodontics, Implant & General Dentistry</b></p><p>Dr. Jeff Esparagoza provides quality dental care in Kidapawan City.</p></div>`,
      services:`<div class="fade-section"><h3>Our Services</h3><ul style="list-style:none;line-height:1.8;padding:0;text-align:center"><li>Pediatric Dentistry</li><li>Restorative Dentistry</li><li>Prosthodontics</li><li>Veneers & Dental Crown</li><li>Cosmetic Dentistry</li><li>Oral Surgery</li><li>Orthodontics</li></ul></div>`,
      protocols:`<div class="fade-section" style="text-align:center;">
        <h3>COVID-19 Dental Practice Protocols</h3>
        <p><b>CORONAVIRUS DISEASE 2019 (COVID-19)</b> is an infectious disease caused by severe acute respiratory syndrome coronavirus-2 (SARS-CoV-2).</p>
        <p>Common symptoms include fever, cough, fatigue, shortness of breath, and loss of smell.</p><p>The <b>Centers for Disease Control and Prevention (CDCP)</b> says it is primarily spread during close contact and by small droplets produced when people cough, sneeze, or talk ‚Äî with close contact being within approximately 1‚Äì2 meters (3‚Äì7 ft).</p>
        <p>The definition shows that the <b>Dental Workforce</b> is at <b>HIGH RISK</b> to contract the said disease. We have created <b>PROTOCOLS</b> in which everyone <b>MUST FOLLOW</b>.</p>
        <h4 style="margin-top:12px;">General Instructions</h4>
        <ul style="list-style:none;margin:0;padding:0;line-height:1.8;">
          <li>NO MASK, NO ENTRY</li>
          <li>OBSERVE SOCIAL DISTANCING</li>
          <li>ALCOHOL IS AVAILABLE FOR PATIENT'S USE</li>
          <li>Only PATIENTS are allowed inside treatment room</li>
          <li>We discourage bringing companions EXCEPT for minor and elder persons</li>
        </ul>
        <h4 style="margin-top:14px;">Schedules / Appointments</h4>
        <p>New Clinic Hours: <b>Monday to Saturday</b><br>9:00 AM ‚Äì 4:00 PM</p>
        <p>Clinic Schedule is now <b>STRICTLY BY APPOINTMENT</b>.</p>
        <p>Reschedule your appointment if you have fever or are not feeling well.</p>
      </div>`,
      contact:`<div class="fade-section"><h3>Contact Us</h3>
        <p>üìç Kidapawan City, North Cotabato, Philippines</p>
        <p>üìû 0977 780 9537</p>
        <p>üìß esparagoza.jeffrey@gmail.com</p></div>`
    };

    /* === Mobile menu open handler === */
    menuBtn.addEventListener("click",()=>{
      openModal(menuHTML());
      setTimeout(()=>{
        document.querySelectorAll("[data-sec]").forEach(btn=>{
          btn.onclick=()=>{
            const sec=btn.getAttribute("data-sec");
            openModal(sections[sec]||"<p>Section not found.</p>");
          };
        });
      },100);
    });
  </script>
</div>
</body>
</html>
