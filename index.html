<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Esparagoza Dental Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif}
body{
  background:linear-gradient(180deg,#e9f4ff 0%,#f4f9ff 100%);
  min-height:100vh;display:flex;flex-direction:column;align-items:center;
  overflow-x:hidden;position:relative;
}
body::before{
  content:"";position:absolute;top:0;left:0;width:100%;height:100%;
  background:radial-gradient(circle at top right,rgba(11,107,203,0.15),transparent 60%);
  pointer-events:none;
}

/* ‚úÖ Fade-in animation for top header */
.fade-header{opacity:0;transform:translateY(-10px);animation:fadeDown .8s ease forwards}
@keyframes fadeDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

label{display:block;margin:8px 0 4px;color:#0b6bcb;font-weight:600}
input,select,textarea{
  width:100%;padding:10px 12px;border:1px solid #d5e6f7;border-radius:10px;
  font-size:15px;outline:none;
}
button{cursor:pointer;transition:.3s}
.btn{
  background:linear-gradient(90deg,#2ea0ff,#0b6bcb);
  color:#fff;border:none;border-radius:10px;
  padding:12px 18px;font-weight:600;width:100%;
}

/* ‚úÖ FIXED Book and Calendar Cards */
.card,.cal-card{
  background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(7,36,63,.08);
  margin:18px auto;padding:22px;max-width:480px;width:92%;box-sizing:border-box;
}
@media(max-width:480px){.card,.cal-card{width:90%;padding:16px;}}

/* Calendar */
.cal-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.cal-month{font-weight:700;color:#0b6bcb;font-size:18px}
.nav-btn{background:linear-gradient(90deg,#2ea0ff,#0b6bcb);color:#fff;border:none;padding:6px 10px;border-radius:10px}
.weeknames{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;color:#3b6b90;font-size:12px;text-align:center;margin-bottom:6px}
.cal-grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:8px;width:100%}
.day-tile{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;border-radius:10px;background:#fff;color:#0b6bcb;font-weight:600;cursor:pointer;transition:background .2s;min-width:0;overflow:hidden}
.day-tile.today{border:2px solid #0b6bcb}
.day-tile.closed{background:#e0e0e0;color:#999;cursor:not-allowed}

/* Slot buttons */
.slot-btn{padding:10px;border:none;border-radius:8px;margin:4px;background:#e7f1ff;color:#0b6bcb;font-weight:600}
.slot-btn.selected{background:#0b6bcb;color:#fff}
.slot-btn.booked{background:#ccc;color:#666;cursor:not-allowed}

/* Toasts */
.toast-wrap{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:1000}
.toast{background:#0b6bcb;color:#fff;padding:10px 16px;border-radius:8px;margin-top:8px;opacity:0;transition:opacity .3s}
.toast.show{opacity:1}
.toast.success{background:#00b386}
.toast.error{background:#d9534f}

/* Header */
.header{width:100%;max-width:520px;display:flex;flex-direction:column;align-items:center;margin-top:10px;gap:6px;position:relative;}
#menuBtn{position:absolute;right:20px;top:10px;background:none;border:none;font-size:26px;color:#0b6bcb;cursor:pointer;line-height:1;}

/* Modal Overlay */
.modal-overlay{
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.35);backdrop-filter:blur(3px);
  justify-content:center;align-items:center;z-index:1001;
}
.modal-content{
  background:#fff;border-radius:16px;max-width:420px;width:90%;
  padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.15);
  color:#0b6bcb;max-height:80vh;overflow-y:auto;animation:fadeIn .3s ease;position:relative;
}
.close-btn{
  position:absolute;top:12px;right:16px;
  background:#0b6bcb;color:#fff;border:none;border-radius:50%;
  width:32px;height:32px;font-size:18px;font-weight:bold;cursor:pointer;transition:background .2s;
}
.close-btn:hover{background:#2ea0ff}

/* Modal menu */
.menu-options{display:flex;flex-direction:column;gap:10px;margin-top:20px}
.menu-tile{
  background:rgba(11,107,203,0.15);color:#0b6bcb;border:none;
  padding:14px;border-radius:10px;font-weight:600;cursor:pointer;transition:all .3s;
}
.menu-tile:hover{background:rgba(11,107,203,0.25)}
.line{height:2px;background:#0b6bcb;width:100%;border-radius:2px;margin:2px 0}
.modal-logo{display:block;margin:0 auto 10px;width:80px;height:auto}
#backBtn{background:none;border:none;color:#0b6bcb;font-weight:700;margin-bottom:10px;cursor:pointer}

/* Fade for section switch */
.fade-section{animation:fadeIn .4s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<!-- üîπ Header (logo centered + menu right) -->
<div class="header fade-header">
  <div style="width:100%;display:flex;align-items:center;justify-content:center;position:relative;">
    <img src="https://i.imgur.com/t942gBV.png" alt="logo" style="height:60px;width:auto;">
    <button id="menuBtn">&#9776;</button>
  </div>
  <h1 style="font-size:22px;font-weight:700;color:#0b6bcb;text-align:center;margin-top:4px;">Esparagoza Dental Hub</h1>
</div>

<!-- Calendar -->
<div class="cal-card">
  <div class="cal-top">
    <button class="nav-btn" id="prevMonth">&#10094;</button>
    <div class="cal-month" id="monthTitle">October 2025</div>
    <button class="nav-btn" id="nextMonth">&#10095;</button>
  </div>
  <div class="weeknames"><div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div></div>
  <div class="cal-grid" id="calGrid"></div>
  <p style="text-align:center;font-size:12px;margin-top:6px;color:#3b6b90">Closed or fully booked dates are grayed out.</p>
</div>

<!-- Booking Form -->
<div class="card">
  <h2 style="color:#0b6bcb;margin-bottom:10px;">Book an Appointment</h2>
  <form id="bookingForm">
    <label>Full Name</label><input type="text" id="name" placeholder="Enter full name" required>
    <label>Email</label><input type="email" id="email" placeholder="Enter email" required>
    <label>Phone</label><input type="text" id="phone" placeholder="Enter phone" required>
    <label>Service</label>
    <select id="service" required>
      <option value="">Select Service</option>
      <option>Pediatric Dentistry</option>
      <option>Restorative Dentistry (Tooth Filling)</option>
      <option>Prosthodontics</option>
      <option>Veneers Dental Crown</option>
      <option>Cosmetic Dentistry</option>
      <option>Oral Surgery</option>
      <option>Orthodontics</option>
    </select>
    <label>Date</label><input type="text" id="date" readonly placeholder="Select date from calendar" required>
    <label>Time</label><input type="text" id="time" readonly placeholder="Select a time slot" required>
    <div id="slotsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:6px;margin:10px 0;"></div>
    <label>Notes (optional)</label><textarea id="notes" rows="2" placeholder="Additional notes"></textarea>
    <button class="btn" type="submit">Submit Booking</button>
  </form>
</div>

<!-- Toast -->
<div class="toast-wrap" id="toastWrap"></div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal-content" id="modalContent">
    <button class="close-btn" id="closeModal">&times;</button>
    <div id="modalMenu">
      <h3 style="text-align:center;">Esparagoza Dental Hub</h3>
      <div class="menu-options">
        <button class="menu-tile" data-section="about">About Us</button>
        <div class="line"></div>
        <button class="menu-tile" data-section="services">Services</button>
        <div class="line"></div>
        <button class="menu-tile" data-section="protocols">Protocols</button>
        <div class="line"></div>
        <button class="menu-tile" data-section="contact">Contact Us</button>
      </div>
    </div>
    <div id="sectionContent" style="display:none;">
      <button id="backBtn">‚Üê Back</button>
      <div id="sectionBody"></div>
    </div>
  </div>
                                                 </div>

  <script type="module">
/* Firebase SDK imports */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, get, set, push, runTransaction } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

/* Firebase configuration */
const firebaseConfig = {
  apiKey: "AIzaSyCV39b2CkzS_tt75SVXa6z95s6f4qVlfLg",
  authDomain: "esparagozadentalclinic-6a744.firebaseapp.com",
  databaseURL: "https://esparagozadentalclinic-6a744-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "esparagozadentalclinic-6a744",
  storageBucket: "esparagozadentalclinic-6a744.firebasestorage.app",
  messagingSenderId: "959639046373",
  appId: "1:959639046373:web:ccf39df13d94e527fcec0c"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
emailjs.init("xvStFrKI-3M-3ZCvz");

/* ==== DOM Elements ==== */
const calGrid = document.getElementById("calGrid");
const monthTitle = document.getElementById("monthTitle");
const prevMonth = document.getElementById("prevMonth");
const nextMonth = document.getElementById("nextMonth");
const dateInput = document.getElementById("date");
const timeInput = document.getElementById("time");
const slotsGrid = document.getElementById("slotsGrid");
const toastWrap = document.getElementById("toastWrap");

/* ==== Variables ==== */
let displayedYear, displayedMonth;
let closedDates = {};
let slotCounts = {};
let maxSlots = 1;

const TIME_SLOTS = [
  "9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM",
  "12:00 NN","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM"
];

/* ==== Helpers ==== */
const fmt = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
const slotKey = s => s.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();
function showToast(msg, type="info") {
  const el = document.createElement("div");
  el.className = "toast " + type;
  el.textContent = msg;
  toastWrap.appendChild(el);
  setTimeout(()=>el.classList.add("show"), 50);
  setTimeout(()=>el.remove(), 3000);
}

/* ==== Firebase Listeners ==== */
onValue(ref(db, "closed_dates"), s => {
  closedDates = s.exists() ? s.val() : {};
  render();
});
onValue(ref(db, "settings/maxSlots"), s => {
  maxSlots = s.exists() ? s.val() : 1;
});
onValue(ref(db, "slot_counts"), s => {
  slotCounts = s.exists() ? s.val() : {};
  render();
});

/* ==== Calendar Rendering ==== */
function render(y, m) {
  const now = new Date();
  if (!y && !m) { y = now.getFullYear(); m = now.getMonth(); }
  displayedYear = y; displayedMonth = m;
  const first = new Date(y, m, 1);
  monthTitle.textContent = first.toLocaleString("default", { month:"long", year:"numeric" });
  calGrid.innerHTML = "";

  const start = first.getDay();
  const daysInMonth = new Date(y, m+1, 0).getDate();

  for (let i=0; i<start; i++) {
    const e = document.createElement("div");
    e.className = "day-tile";
    e.style.visibility = "hidden";
    calGrid.appendChild(e);
  }

  for (let d=1; d<=daysInMonth; d++) {
    const date = new Date(y, m, d);
    const iso = fmt(date);
    const div = document.createElement("div");
    div.className = "day-tile";
    div.textContent = d;

    if (closedDates[iso]) div.classList.add("closed");
    else if (date < new Date().setHours(0,0,0,0)) div.style.opacity = .4;
    else div.onclick = () => {
      dateInput.value = iso;
      loadSlots(iso);
      showToast("Selected " + iso, "success");
    };

    const today = new Date();
    today.setHours(0,0,0,0);
    if (date.getTime() === today.getTime()) div.classList.add("today");
    calGrid.appendChild(div);
  }
}
prevMonth.onclick = () => {
  const d = new Date(displayedYear, displayedMonth - 1, 1);
  render(d.getFullYear(), d.getMonth());
};
nextMonth.onclick = () => {
  const d = new Date(displayedYear, displayedMonth + 1, 1);
  render(d.getFullYear(), d.getMonth());
};
render();

/* ==== Load Available Time Slots ==== */
async function loadSlots(dateKey) {
  slotsGrid.innerHTML = "";
  const cSnap = await get(ref(db, `slot_counts/${dateKey}`));
  const counts = cSnap.exists() ? cSnap.val() : {};
  TIME_SLOTS.forEach(slot => {
    const k = slotKey(slot);
    const c = counts[k] || 0;
    const full = c >= maxSlots;
    const b = document.createElement("button");
    b.className = "slot-btn";
    b.textContent = slot + (full ? " ‚Ä¢ FULL" : "");
    if (full) b.classList.add("booked");
    else b.onclick = () => {
      timeInput.value = slot;
      document.querySelectorAll(".slot-btn").forEach(x => x.classList.remove("selected"));
      b.classList.add("selected");
    };
    slotsGrid.appendChild(b);
  });
}

/* ==== Submit Booking ==== */
document.getElementById("bookingForm").onsubmit = async e => {
  e.preventDefault();
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const notes = document.getElementById("notes").value.trim();
  const service = document.getElementById("service").value;
  const date = dateInput.value;
  const time = timeInput.value;
  if (!date || !time) return showToast("Select date & time!", "error");

  const key = slotKey(time);
  const slotRef = ref(db, `slot_counts/${date}/${key}`);

  try {
    const booked = await runTransaction(slotRef, count => (count || 0) + 1);
    if (booked.snapshot.val() > maxSlots) {
      showToast("Time slot already full!", "error");
      return;
    }

    const newRef = push(ref(db, "bookings"));
    await set(newRef, { name, email, phone, service, date, time, notes, createdAt: new Date().toISOString() });

    emailjs.send("service_vyxj5pq","template_dg1ay8i",{
      name,email,phone,service,date,time,notes
    });

    showToast("Booking successful!", "success");
    e.target.reset();
    timeInput.value = "";
    render(displayedYear, displayedMonth);
  } catch (err) {
    console.error(err);
    showToast("Booking failed!", "error");
  }
};

/* ==== Modal & Menu ==== */
const overlay = document.getElementById("modalOverlay");
const menu = document.getElementById("modalMenu");
const section = document.getElementById("sectionContent");
const sectionBody = document.getElementById("sectionBody");
const menuBtn = document.getElementById("menuBtn");
const closeModal = document.getElementById("closeModal");
const backBtn = document.getElementById("backBtn");

menuBtn.onclick = () => { overlay.style.display = "flex"; menu.style.display = "block"; section.style.display = "none"; };
closeModal.onclick = () => overlay.style.display = "none";
backBtn.onclick = () => { section.style.display = "none"; menu.style.display = "block"; };

/* Modal sections content */
const modalData = {
  about: `
    <div style="text-align:center;">
      <img src="https://i.imgur.com/t942gBV.png" class="modal-logo" alt="logo" style="margin-bottom:10px;">
      <h3>About Us</h3>
      <p><b>Orthodontics, Implant & General Dentistry</b></p>
      <p>Dr. Jeff Esparagoza provides dental services such as orthodontics, implant, and general dentistry.</p>
    </div>
  `,
  services: `
    <div style="text-align:center;">
      <h3>Our Dental Services</h3>
      <ul style="margin-top:10px;line-height:1.8;list-style:none;padding:0;">
        <li>Pediatric Dentistry ‚Äî 30 minutes</li>
        <li>Restorative Dentistry (Tooth Filling) ‚Äî 30 minutes</li>
        <li>Prosthodontics ‚Äî 30 minutes</li>
        <li>Veneers Dental Crown ‚Äî 30 minutes</li>
        <li>Cosmetic Dentistry ‚Äî 30 minutes</li>
        <li>Oral Surgery ‚Äî 30 minutes</li>
        <li>Orthodontics ‚Äî 30 minutes</li>
      </ul>
    </div>
  `,
  protocols: `
    <div style="text-align:center;">
      <h3>COVID-19 Dental Practice Protocols</h3>
      <p>Coronavirus Disease 2019 (COVID-19) is an infectious disease caused by SARS-CoV-2.<br>
      Common symptoms include fever, cough, fatigue, and loss of smell.</p>
      <p>The CDC says it is primarily spread during close contact by droplets when people cough,
      sneeze, or talk. Dental professionals are at high risk, and we enforce strict protocols:</p>
      <ul style="margin-top:10px;line-height:1.8;list-style:none;padding:0;">
        <li>NO MASK, NO ENTRY</li>
        <li>OBSERVE SOCIAL DISTANCING</li>
        <li>ALCOHOL AVAILABLE FOR PATIENT USE</li>
        <li>ONLY PATIENTS ALLOWED INSIDE TREATMENT ROOM</li>
        <li>NO COMPANIONS EXCEPT MINORS/ELDERS</li>
      </ul>
    </div>
  `,
  contact: `
    <div style="text-align:center;">
      <h3>Contact Us</h3>
      <p>üìç Kidapawan City, North Cotabato, Philippines</p>
      <p>üìû 0977 780 9537</p>
      <p>üìß esparagoza.jeffrey@gmail.com</p>
    </div>
  `
};

/* Handle modal buttons */
document.querySelectorAll(".menu-tile").forEach(btn => {
  btn.addEventListener("click", () => {
    const sec = btn.dataset.section;
    sectionBody.innerHTML = modalData[sec] || "";
    menu.style.display = "none";
    section.style.display = "block";
    sectionBody.classList.add("fade-section");
  });
});
</script>
</body>
  </html>
