<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Esparagoza Dental Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<style>
:root{
  --brand:#0b6bcb;
  --accent:#2ea0ff;
  --success:#00b386;
  --danger:#d9534f;
  --card-bg:#ffffff;
  --muted:#758aa2;
  --hero-padding-top:120px;
  --protocol-max-h:320px;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif;scroll-behavior:smooth}
html,body{height:100%}
body{
  background:linear-gradient(180deg,#e9f4ff 0%,#f4f9ff 100%);
  color:var(--brand);
  overflow-x:hidden;
  min-height:100vh;
}

/* ---------- NAV (fixed top-left) ---------- */
.front-top{
  position:fixed;top:20px;left:20px;z-index:1200;
}
.nav-links{
  display:flex;gap:10px;background:rgba(255,255,255,.08);padding:8px 12px;border-radius:12px;
}
.nav-item{position:relative;padding:6px 12px;color:#fff;font-weight:700;cursor:pointer}
.nav-item:hover{background:rgba(255,255,255,.08)}
.dropdown{
  display:none;position:absolute;top:110%;left:0;
  transform:translateY(6px);
  background:rgba(255,255,255,.94);backdrop-filter:blur(8px);
  color:var(--brand);padding:12px 14px;border-radius:0;
  min-width:300px;max-width:420px;box-shadow:0 12px 36px rgba(0,0,0,.14);
  opacity:0;pointer-events:none;z-index:1300;
}
.nav-item:hover .dropdown{display:block;opacity:1;pointer-events:all;transform:translateY(0);transition:opacity .25s,transform .25s}
.dropdown h4{font-size:15px;font-weight:700;margin-bottom:8px;border-bottom:1px solid #dfeefb;padding-bottom:6px}
.dropdown p,.dropdown li{font-size:13px;line-height:1.5;margin:6px 0;color:#234a6b}
.dropdown ul{padding-left:14px;margin-top:6px}

/* contact alignment fix (right-most) */
.nav-item.contact .dropdown{left:auto;right:0;transform:translateY(6px)}

/* protocols scroll area */
.dropdown .protocol-scroll{max-height:var(--protocol-max-h);overflow:auto;padding-right:8px}
.dropdown .protocol-scroll::-webkit-scrollbar{width:8px}
.dropdown .protocol-scroll::-webkit-scrollbar-thumb{background:rgba(11,107,203,.12);border-radius:6px}

/* ---------- HERO ---------- */
.hero{ text-align:center; padding-top:var(--hero-padding-top); padding-bottom:36px }
.logo-big{width:160px;height:auto;margin:0 auto 12px;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.12)}
.welcome{font-size:28px;font-weight:700;margin-top:8px;color:var(--brand)}
.hero-sub{color:var(--muted);font-size:14px;margin-top:6px}
.cta-btn{margin-top:14px;padding:12px 20px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--brand));color:#fff;font-weight:700;cursor:pointer}

/* ---------- MEDIA SHOWCASE (image left / video right) ---------- */
.media-showcase{display:flex;align-items:center;justify-content:center;gap:22px;padding:22px 18px;margin:18px auto;max-width:1100px}
.media-left, .media-right{flex:0 0 48%;max-width:48%}
.media-left img, .media-right video{width:100%;height:360px;object-fit:cover;border-radius:14px;box-shadow:0 10px 36px rgba(0,0,0,.12)}
@media(max-width:1000px){
  .media-left img,.media-right video{height:260px}
}
@media(max-width:900px){
  .media-showcase{flex-direction:column;padding:12px}
  .media-left,.media-right{max-width:100%;flex:1 1 auto}
  .media-left img,.media-right video{height:auto}
}

/* ---------- BOOKING / CALENDAR ---------- */
#bookingPage{max-width:1100px;margin:36px auto;padding:20px}
.card{background:var(--card-bg);border-radius:14px;box-shadow:0 10px 30px rgba(7,36,63,.08);padding:18px;margin:18px auto;max-width:720px}
label{display:block;margin-top:10px;font-weight:600}
input,select,textarea{width:100%;padding:10px 12px;border:1px solid #dbeffb;border-radius:10px;margin-top:6px;font-size:15px}
.btn-primary{cursor:pointer;transition:.25s;background:linear-gradient(90deg,var(--accent),var(--brand));color:#fff;border:none;border-radius:10px;padding:12px 18px;font-weight:700}
.weeknames{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;color:#3b6b90;font-size:12px;text-align:center;margin-bottom:8px}
.cal-grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:8px}
.day-tile{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;border-radius:10px;background:#fff;color:var(--brand);font-weight:600;cursor:pointer;transition:transform .15s}
.day-tile:hover{transform:scale(1.04)}
.day-tile.today{border:2px solid var(--brand)}
.day-tile.closed{background:#f1f3f6;color:#8d98a6;cursor:not-allowed}
.slot-btn{padding:10px;border:none;border-radius:8px;margin:6px;background:#e7f1ff;color:var(--brand);font-weight:600;cursor:pointer}
.slot-btn.selected{background:var(--brand);color:#fff}
.slot-btn.booked{background:#e0e0e0;color:#888;cursor:not-allowed}

/* toast + modal */
.toast-wrap{position:fixed;bottom:22px;left:50%;transform:translateX(-50%);z-index:1400}
.toast{background:var(--brand);color:#fff;padding:10px 16px;border-radius:8px;margin-top:8px;opacity:0;transition:opacity .3s}
.toast.show{opacity:1}
.toast.success{background:var(--success)}
.toast.error{background:var(--danger)}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(3px);justify-content:center;align-items:center;z-index:1500;opacity:0;transition:opacity .3s}
.modal-overlay.show{display:flex;opacity:1}
.modal-content{background:#fff;border-radius:12px;max-width:520px;width:92%;padding:16px;box-shadow:0 12px 36px rgba(0,0,0,.16);color:var(--brand);max-height:82vh;overflow:auto}
.close-btn{position:absolute;top:10px;right:12px;background:var(--brand);color:#fff;border-radius:50%;border:none;width:34px;height:34px}

/* responsive small screens */
@media(max-width:700px){
  .logo-big{width:140px}
  .welcome{font-size:20px}
  .media-left img,.media-right video{height:220px}
}
</style>
</head>

  <body>
<div class="app">

  <!-- Fixed Left Menu -->
  <div class="front-top">
    <nav class="nav-links" id="desktopNav">
      <div class="nav-item">About Us
        <div class="dropdown">
          <h4>About Us</h4>
          <p><b>Orthodontics, Implant & General Dentistry</b></p>
          <p>Dr. Jeff Esparagoza provides quality dental care in Kidapawan City.</p>
        </div>
      </div>

      <div class="nav-item">Services
        <div class="dropdown">
          <h4>Services</h4>
          <ul>
            <li>Pediatric Dentistry</li>
            <li>Restorative Dentistry</li>
            <li>Prosthodontics</li>
            <li>Veneers & Dental Crown</li>
            <li>Cosmetic Dentistry</li>
            <li>Oral Surgery</li>
            <li>Orthodontics</li>
          </ul>
        </div>
      </div>

      <div class="nav-item">Protocols
        <div class="dropdown">
          <div class="protocol-scroll">
            <h4>COVID-19 Dental Practice Protocols</h4>
            <p><b>CORONAVIRUS DISEASE 2019 (COVID-19)</b> is an infectious disease caused by severe acute respiratory syndrome coronavirus-2 (SARS-CoV-2).</p>
            <p>Common symptoms include fever, cough, fatigue, shortness of breath, and loss of smell.</p>
            <p>The <b>Centers for Disease Control and Prevention (CDCP)</b> says it is primarily spread during close contact and by small droplets produced when people cough, sneeze or talk ‚Äî with close contact being within approximately 1‚Äì2 meters (3‚Äì7 ft).</p>
            <p>The definition shows that the <b>Dental Workforce</b> is at <b>HIGH RISK</b> to contract the said disease. We have created <b>PROTOCOLS</b> in which everyone <b>MUST FOLLOW</b>.</p>

            <h4 style="margin-top:10px;">General Instructions</h4>
            <ul>
              <li>NO MASK, NO ENTRY</li>
              <li>OBSERVE SOCIAL DISTANCING</li>
              <li>ALCOHOL IS AVAILABLE FOR PATIENT'S USE</li>
              <li>Only PATIENTS are allowed inside treatment room</li>
              <li>We discourage bringing companions EXCEPT for minor and elder persons</li>
            </ul>

            <h4 style="margin-top:10px;">Schedules / Appointments</h4>
            <p>New Clinic Hours: <b>Monday to Saturday</b> ‚Äî 9:00 AM to 4:00 PM</p>
            <p>Clinic Schedule is now <b>STRICTLY BY APPOINTMENT</b>. Reschedule if you have fever or are not feeling well.</p>
          </div>
        </div>
      </div>

      <div class="nav-item contact">Contact
        <div class="dropdown">
          <h4>Contact Us</h4>
          <p>üìç Kidapawan City, North Cotabato</p>
          <p>üìû 0977 780 9537</p>
          <p>üìß esparagoza.jeffrey@gmail.com</p>
        </div>
      </div>
    </nav>
  </div>

  <!-- HERO / Welcome -->
  <section class="hero" id="frontPage">
    <img src="https://i.imgur.com/t942gBV.png" class="logo-big" alt="Esparagoza Dental Logo">
    <div class="welcome">Welcome to Esparagoza Dental Clinic</div>
    <div class="hero-sub">Orthodontics ‚Ä¢ Implant ‚Ä¢ General Dentistry ‚Äî Kidapawan City</div>
    <button class="cta-btn" id="toBookingBtn">Make an Appointment</button>
  </section>

  <!-- Media Showcase: picture (left) + video (right) -->
  <section class="media-showcase" aria-hidden="false">
    <div class="media-left">
      <img src="https://images.unsplash.com/photo-1606813909026-07c58b8de3f6?w=1400&auto=format&fit=crop" alt="clinic image">
    </div>
    <div class="media-right">
      <video id="heroVideo" autoplay muted loop playsinline>
        <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </section>

  <!-- Booking page (calendar + form) -->
  <main id="bookingPage">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <button class="btn-primary" id="prevMonth" style="width:48px">&#10094;</button>
        <div style="font-weight:700;color:var(--brand);font-size:18px" id="monthTitle">Month</div>
        <button class="btn-primary" id="nextMonth" style="width:48px">&#10095;</button>
      </div>

      <div class="weeknames">
        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div>
        <div>Thu</div><div>Fri</div><div>Sat</div>
      </div>

      <div class="cal-grid" id="calGrid"></div>
      <p style="text-align:center;font-size:13px;margin-top:8px;color:#3b6b90">Click a date to choose, then pick a time slot below.</p>
    </div>

    <div class="card" id="bookingFormSection" style="max-width:820px;">
      <h3 style="color:var(--brand);margin-bottom:10px">Book an Appointment</h3>
      <form id="bookingForm">
        <div style="display:grid;grid-template-columns:1fr;gap:8px">
          <label>Full Name</label><input type="text" id="name" required>
          <label>Email</label><input type="email" id="email" required>
          <label>Phone</label><input type="text" id="phone" required>
          <label>Service</label>
          <select id="service" required>
            <option value="">Select Service</option>
            <option>Pediatric Dentistry</option>
            <option>Restorative Dentistry (Tooth Filling)</option>
            <option>Prosthodontics</option>
            <option>Veneers Dental Crown</option>
            <option>Cosmetic Dentistry</option>
            <option>Oral Surgery</option>
            <option>Orthodontics</option>
          </select>

          <label>Date</label><input type="text" id="date" readonly required>
          <label>Time</label><input type="text" id="time" readonly required>

          <div id="slotsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-top:6px"></div>

          <label>Notes (optional)</label><textarea id="notes" rows="3"></textarea>
          <button class="btn-primary" type="button" id="submitBookingBtn">Submit Booking</button>
        </div>
      </form>
    </div>
  </main>

  <div class="toast-wrap" id="toastWrap"></div>

  <!-- modal (mobile) -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <button class="close-btn" id="closeModal">&times;</button>
      <div id="sectionContent"></div>
    </div>
  </div>
</div>

<!-- ====== Scripts: Firebase, Calendar, Booking, EmailJS, UI ====== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, onValue, get, set, push, runTransaction } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  /* ========== Firebase config (existing) ========== */
  const firebaseConfig = {
    apiKey:"AIzaSyCV39b2CkzS_tt75SVXa6z95s6f4qVlfLg",
    authDomain:"esparagozadentalclinic-6a744.firebaseapp.com",
    databaseURL:"https://esparagozadentalclinic-6a744-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId:"esparagozadentalclinic-6a744",
    storageBucket:"esparagozadentalclinic-6a744.firebasestorage.app",
    messagingSenderId:"959639046373",
    appId:"1:959639046373:web:ccf39df13d94e527fcec0c"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  /* ========== Helpers & DOM ========== */
  const el = id => document.getElementById(id);
  const toastWrap = el("toastWrap");
  const calGrid = el("calGrid"), prevMonth = el("prevMonth"), nextMonth = el("nextMonth"), monthTitle = el("monthTitle");
  const dateInput = el("date"), timeInput = el("time"), slotsGrid = el("slotsGrid");
  const toBookingBtn = el("toBookingBtn"), bookingPage = el("bookingPage");
  const modalOverlay = el("modalOverlay"), closeModal = el("closeModal"), sectionContent = el("sectionContent");

  function showToast(msg,type="info"){
    const t=document.createElement("div"); t.className = `toast ${type}`; t.textContent=msg; toastWrap.appendChild(t);
    setTimeout(()=>t.classList.add("show"),100); setTimeout(()=>t.remove(),3500);
  }

  /* ========== App state ========== */
  let displayedYear, displayedMonth;
  let closedDates = {}, slotCounts = {}, maxSlots = 1;
  const TIME_SLOTS = ["9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 NN","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM"];
  const fmt = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  const slotKey = s => s.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();

  /* ========== Listen Firebase nodes ========== */
  onValue(ref(db,"closed_dates"), snap => { closedDates = snap.exists()?snap.val():{}; renderCalendar(displayedYear,displayedMonth); });
  onValue(ref(db,"settings/maxSlots"), snap => { maxSlots = snap.exists()?snap.val():1; });
  onValue(ref(db,"slot_counts"), snap => { slotCounts = snap.exists()?snap.val():{}; renderCalendar(displayedYear,displayedMonth); });
  onValue(ref(db,"dentist_status"), snap => {
    const v = snap.exists()?String(snap.val()).toUpperCase():"OUT";
    // optional: show somewhere if you have element
  });

  /* ========== Calendar rendering ========== */
  function renderCalendar(y,m){
    const now = new Date();
    if (typeof y === "undefined" || typeof m === "undefined"){ y = now.getFullYear(); m = now.getMonth(); }
    displayedYear = y; displayedMonth = m;
    const first = new Date(y,m,1);
    monthTitle.textContent = first.toLocaleString("default",{month:"long",year:"numeric"});
    calGrid.innerHTML = "";
    const start = first.getDay(), days = new Date(y,m+1,0).getDate();
    for (let i=0;i<start;i++){ const placeholder=document.createElement("div"); placeholder.className="day-tile"; placeholder.style.visibility="hidden"; calGrid.appendChild(placeholder); }
    for (let d=1; d<=days; d++){
      const date = new Date(y,m,d), iso = fmt(date);
      const tile = document.createElement("div"); tile.className="day-tile"; tile.textContent = d;
      const counts = slotCounts[iso] || {};
      const fullyBooked = Object.values(counts).filter(v=>v>=maxSlots).length >= TIME_SLOTS.length;
      if (closedDates[iso] || fullyBooked) tile.classList.add("closed");
      else if (date < (new Date()).setHours(0,0,0,0)) tile.style.opacity = .5;
      else tile.addEventListener("click", ()=>{ dateInput.value = iso; loadSlots(iso); showToast("Selected " + iso,"success"); el("bookingFormSection").scrollIntoView({behavior:"smooth"}); });
      const t = new Date(); t.setHours(0,0,0,0); if (date.getTime() === t.getTime()) tile.classList.add("today");
      calGrid.appendChild(tile);
    }
  }
  prevMonth.addEventListener("click", ()=>{ const d=new Date(displayedYear,displayedMonth-1,1); renderCalendar(d.getFullYear(),d.getMonth()); });
  nextMonth.addEventListener("click", ()=>{ const d=new Date(displayedYear,displayedMonth+1,1); renderCalendar(d.getFullYear(),d.getMonth()); });
  renderCalendar();

  /* ========== Load slots for selected date ========== */
  async function loadSlots(dateKey){
    slotsGrid.innerHTML = "";
    const snap = await get(ref(db,`slot_counts/${dateKey}`));
    const counts = snap.exists()?snap.val():{};
    TIME_SLOTS.forEach(slot=>{
      const k = slotKey(slot), c = counts[k]||0, full = c >= maxSlots;
      const btn = document.createElement("button"); btn.className = "slot-btn";
      btn.textContent = slot + (full ? " ‚Ä¢ FULL" : "");
      if (full) btn.classList.add("booked");
      else btn.addEventListener("click", ()=>{ timeInput.value = slot; document.querySelectorAll(".slot-btn").forEach(x=>x.classList.remove("selected")); btn.classList.add("selected"); });
      slotsGrid.appendChild(btn);
    });
  }

  /* ========== Booking submit (click-only) ========== */
  const nameEl = el("name"), emailEl = el("email"), phoneEl = el("phone"), serviceEl = el("service"), notesEl = el("notes");
  // prevent Enter auto-submit
  el("bookingForm").addEventListener("keydown", e=>{ if (e.key === "Enter") e.preventDefault(); });

  el("submitBookingBtn").addEventListener("click", async e=>{
    e.preventDefault();
    const name = nameEl.value.trim(), email = emailEl.value.trim(), phone = phoneEl.value.trim();
    const service = serviceEl.value, date = dateInput.value, time = timeInput.value, notes = notesEl.value.trim();
    if (!name || !email || !phone || !service) return showToast("Please fill required fields","error");
    if (!date || !time) return showToast("Select date & time","error");

    const key = slotKey(time);
    const slotRef = ref(db,`slot_counts/${date}/${key}`);
    try{
      // Use transaction to increment slot count safely
      const tx = await runTransaction(slotRef, current => (current||0) + 1);
      if (tx.snapshot.val() > maxSlots){
        showToast("Time slot full!","error");
        return;
      }
      const newRef = push(ref(db,"bookings"));
      await set(newRef,{ name, email, phone, service, date, time, notes, createdAt: new Date().toISOString() });

      // send email (EmailJS)
      try{ emailjs.init("cVyQCkIy0P6hPyKrH"); await emailjs.send("service_7k6q958","template_td348he",{name,email,phone,service,date,time,notes}); showToast("Confirmation email sent!","success"); }
      catch(e){ console.warn("EmailJS failed",e); showToast("Booking saved (email not sent)","success"); }

      showToast("Booking successful!","success");
      el("bookingForm").reset(); timeInput.value = ""; renderCalendar(displayedYear,displayedMonth);
    }catch(err){
      console.error(err);
      showToast("Booking failed","error");
    }
  });

  /* ========== Front -> Booking transition ========== */
  toBookingBtn.addEventListener("click", ()=>{ window.scrollTo({top: document.getElementById("bookingPage").offsetTop - 20, behavior:"smooth"}); });

  /* ========== Mobile menu modal (if needed) ========== */
  function openModal(html){ sectionContent.innerHTML = html; modalOverlay.style.display = "flex"; setTimeout(()=>modalOverlay.classList.add("show"),10); }
  function closeModalNow(){ modalOverlay.classList.remove("show"); setTimeout(()=>modalOverlay.style.display="none",300); }
  closeModal.addEventListener("click", closeModalNow);
  modalOverlay.addEventListener("click", e=>{ if (e.target === modalOverlay) closeModalNow(); });

  /* ========== Small UI safeguards ========== */
  // adjust dropdowns to avoid overflow right
  function adjustDropdowns(){
    document.querySelectorAll(".nav-item").forEach(item=>{
      const dd = item.querySelector(".dropdown");
      if (!dd) return;
      dd.style.left = ""; dd.style.right = "";
      const rect = dd.getBoundingClientRect();
      if (rect.right > window.innerWidth - 12) dd.style.left = "auto", dd.style.right = "0";
      else dd.style.left = "0";
    });
  }
  window.addEventListener("resize", adjustDropdowns);
  setTimeout(adjustDropdowns,300);

  /* ========== Pause hero video when offscreen on small devices ========== */
  function handleVideoPlayback(){
    const v = el("heroVideo");
    if (!v) return;
    if (window.innerWidth <= 900) v.pause(); else v.play().catch(()=>{});
  }
  window.addEventListener("resize", handleVideoPlayback);
  handleVideoPlayback();

</script>
</body>
</html>
